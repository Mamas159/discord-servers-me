{% extends "base.html" %}
{% load humanize static %}
{% block title %}
	Dashboard
{% endblock title %}
{% block content %}
	<div class="grey darken-2 row" style="padding: 1rem 0;">
		<div class="col s12 m4">
			<div class="center">
				<img class="circle z-depth-3" src="{{ request.user.avatar_url }}">
				<h5 class="name" style="margin:0;">{{ request.user.get_name_tag }}</h5>
			</div>
		</div>
		<div class="col s12 m8">
			<h5>How to add a server</h5>
			<span id="guide-toggle" class="btn waves-effect waves-light indigo">Too long, short version please</span>
			<div id="guide">
				<div id="long">
					<ul>
						<li>• <a href="{{ bot_invite_link }}" target="_blank" class="teal-text text-lighten-2"><strong>CLICK HERE</strong></a> to add our bot to your server.</li>
						<li>• <strong>It will then help you get the information like Server Name, Member Count, Emoji Count, Emoji Icons,...</strong> so you don't have to worry about filling these information!</li>
						<li>• <strong>Refresh this page</strong> to see the server. It's that easy!</li>
						<li>• Last step: <strong>Provide some short description, description, a PERMANENT invite link, and check that Shown checkbox</strong>.</li>
						<li>DONE!</li>
					</ul>
				</div>
				<div id="short" style="display: none;">
					<ul>
						<li>• <a href="{{ bot_invite_link }}" target="_blank" class="teal-text text-lighten-2"><strong>CLICK HERE</strong></a> to add our bot to your server.</li>
						<li>• <strong>Refresh this page</strong> to see the server.</li>
						<li>• <strong>Provide short description, description, a PERMANENT invite link, check Shown</strong>. DONE!</li>
					</ul>
				</div>
			</div>
			
			
		</div>
		
	</div>
	<div id="server-list">
		<div class="row">
			{% for server in servers %}
				{% include 'includes/server_card.html' %}
			{% empty %}
				<div class="center"><h4>You don't have any servers. Please follow the instruction above to add one.</h4></div>
			{% endfor %}
		</div>
	</div>
	{% if servers.exists %}
		<div class="center">
			{% include 'includes/paginator.html' %}
		</div>
	{% endif %}
	
{% endblock content %}
{% block javascript %}
	<script src="{% static 'js/csrf_token_retriever.js' %}"></script>
	<script>
		$("#guide-toggle").on('click', function(e){
			text = $(this).text();
			if (text == 'Too long, short version please') {
				$(this).text('Give me long version');
			} else {
				$(this).text('Too long, short version please')
			}
			$("#guide #long").toggle();
			$("#guide #short").toggle();
		})

		$(".bumper").on('click', function(e){
			var sid = $(this).data('sid');
			var bumper = $(this);
			var notification = $(this).parents('.card-content').find('.bump_notification')[0];
			// console.log(notification)
			$.ajax({
				type: "POST",
				data: {'sid': sid},
				success: function(response){
					bumper.remove();
					if (response.success) {
						$(notification).fadeIn();
						$(notification).html(response.success);
						$(notification).delay(3000);
						$(notification).fadeOut();
					} else if (response.error) {
						$(notification).fadeIn();
						$(notification).html(response.error);
						$(notification).delay(3000);
						$(notification).fadeOut();
					}
					
				},
			})
		})
	</script>
{% endblock javascript %}